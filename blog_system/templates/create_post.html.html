{% extends "base.html" %}

{% block title %}Create Post - Blog System{% endblock %}

{% block content %}
    <h2>Create New Post</h2>
    
    <form action="/posts/" method="post" id="createForm">
        <div>
            <label for="authorId">Author:</label>
            <select id="authorId" name="authorId" required>
                <option value="">Select Author</option>
                {% for user in users %}
                    <option value="{{ user.id }}">{{ user.login }} ({{ user.email }})</option>
                {% endfor %}
            </select>
        </div>
        
        <div>
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" required minlength="1">
        </div>
        
        <div>
            <label for="content">Content:</label>
            <textarea id="content" name="content" required minlength="1"></textarea>
        </div>
        
        <button type="submit" class="btn btn-success">Create Post</button>
        <a href="/posts/html/" class="btn">Cancel</a>
    </form>

    <script>
        document.getElementById('createForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                authorId: parseInt(document.getElementById('authorId').value),
                title: document.getElementById('title').value,
                content: document.getElementById('content').value
            };
            
            try {
                const response = await fetch('/posts/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                if (response.ok) {
                    alert('Post created successfully!');
                    window.location.href = '/posts/html/';
                } else {
                    const error = await response.json();
                    alert('Error: ' + error.detail);
                }
            } catch (error) {
                alert('Error creating post: ' + error.message);
            }
        });
    </script>
{% endblock %}